---
title: 기본 사용법
order: 2
---

# 기본 사용법

관리자와 사용자(투표자)가 각각 하는 일을 단계별로 정리했습니다. 인증은 **Google 로그인** 기준입니다.

---

## 관리자(Admin)

관리자는 **투표 등록**, **투표자 등록**, **투표 등록 마감**까지 담당합니다. 관리자 웹에서 Google 로그인 후 진행합니다.

### 1. 투표 등록

- 새 투표를 생성할 때 **제목**, **설명**, **후보(선택지, option)** 목록, **시작일·종료일**을 입력합니다.
- 컨트랙트에 vote session이 만들어지고, 이 시점에는 **투표자 등록만** 받는 상태입니다.

### 2. 투표자 등록

- 참여할 사용자들이 사용자 웹에서 "참여하기" 등으로 **등록 요청**을 보내면, 각자의 **commitment**가 생성됩니다.
- 관리자는 이 commitment를 컨트랙트에 반영합니다.
  - 단건: `appendCommitment(voteId, commitment)`
  - 여러 명: `appendCommitmentsBatch(voteId, commitments[])`
- 사용자의 **secret**은 사용자 기기에만 있고, 관리자나 서버에는 전달되지 않습니다.

### 3. 투표 등록 마감

- 등록을 더 이상 받지 않을 시점에:
  1. 등록된 commitment들로 **Merkle tree**를 구성하고 **Merkle root**를 계산합니다.
  2. 컨트랙트에 `setVoterRegistryRoot(voteId, voterRegistryRoot)`로 root를 설정합니다.
  3. `closeRegistration(voteId)`를 호출해 등록을 마감하고, 동시에 **투표 기간**이 시작됩니다.
- 이 후에는 **등록된 투표자만** 투표할 수 있습니다.

### 관리자 요약

| 단계 | 할 일 |
|------|--------|
| 투표 등록 | 제목, 설명, 후보, 기간으로 vote session 생성 |
| 투표자 등록 | 사용자 commitment를 `appendCommitment` / `appendCommitmentsBatch`로 등록 |
| 등록 마감 | Merkle root 설정 → `closeRegistration` 호출 → 투표 기간 시작 |

---

## 사용자(투표자)

사용자는 **참여 등록** → **proof 생성** → **투표** 순서로 진행합니다. 사용자 웹에서 **Google 로그인** 후 이용합니다.

### 1. 참여 등록

- 투표 목록에서 참여할 투표를 고른 뒤 **등록**(또는 "참여하기")을 누릅니다.
- Google 로그인으로 본인 확인 후, 앱이 **commitment**를 만들어 서버·컨트랙트에 등록 요청을 보냅니다.
- **Secret**은 본인 기기에만 저장됩니다. 이 secret으로 나중에 ZK proof를 만들므로, 같은 기기·같은 계정으로 투표하는 것이 좋습니다.

### 2. 증명(proof) 생성

- **투표 기간** 안에, 투표 화면에서 원하는 **후보(option)**를 선택한 뒤 **투표** 버튼을 누릅니다.
- 앱이 **브라우저에서** 다음을 수행합니다:
  - 저장된 **secret**과 현재 vote 정보로 **ZK proof**(Groth16) 생성
  - public inputs(merkle root, nullifier, vote commitment, candidate count) 준비
- proof는 클라이언트에서만 만들어지며, 첫 생성 시 수 초 걸릴 수 있습니다.

### 3. 투표

- 생성된 **proof**와 **public inputs**를 담아 **castVote** 트랜잭션이 블록체인에 제출됩니다.
- 컨트랙트가 Precompile(0x16)으로 proof를 검증하고, **nullifier** 중복을 체크한 뒤 한 표로 집계합니다.
- 트랜잭션이 확정되면 투표 완료입니다. **한 사람 한 표**만 유효합니다.

### 실패하는 경우

- **이미 투표함**: 같은 identity로 같은 투표에 두 번 제출할 수 없습니다(nullifier 중복).
- **등록되지 않음**: 해당 vote의 참여자로 등록되지 않으면 proof 검증에서 거절됩니다.
- **투표 기간 아님**: 시작 전이거나 종료된 투표에는 제출할 수 없습니다.
- **네트워크 오류**: RPC·네트워크 문제로 트랜잭션이 실패할 수 있습니다. 오류 메시지를 확인한 뒤 재시도하거나 운영자에게 문의하면 됩니다.

### 사용자 요약

| 단계 | 할 일 |
|------|--------|
| 참여 등록 | Google 로그인 → 등록 요청 → commitment 등록 (secret은 기기에만 보관) |
| proof 생성 | 투표 기간에 선택지 선택 → 앱이 브라우저에서 ZK proof 생성 |
| 투표 | proof 포함 castVote 트랜잭션 제출 → 한 사람 한 표 |

---

## 결과 확인

투표 **종료 후**에는 결과 화면에서 **후보(option)별 득표 수**를 볼 수 있습니다. ZK 특성상 "누가 어떤 선택을 했는지"는 공개되지 않고, **집계된 숫자만** 공개됩니다. 블록체인으로 "한 사람 한 표", "등록된 참여자만 투표"가 검증 가능합니다.

투표가 어떤 네트워크(노드)에서 검증되는지 궁금하면 [노드에 대해 (엔드 유저용)](/docs/zk-vote/guides/node)를 참고하면 됩니다.
