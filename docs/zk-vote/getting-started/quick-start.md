---
title: 전체 흐름
order: 2
---

# 전체 흐름

ZK 투표는 **관리자**가 투표를 만들고 등록을 마감한 뒤, **사용자(투표자)** 가 proof를 생성해 투표하는 순서로 진행됩니다.

## 흐름 개요

```
[관리자] 투표 등록 → [관리자] 투표자 등록 → [관리자] 투표 등록 마감
        → [사용자] 증명(proof) 생성 → [사용자] 투표
```

---

## 1. 관리자: 투표 등록

관리자 웹에 **Google 로그인**한 뒤, 새 투표를 만듭니다.

- **투표 제목·설명**: 주제와 안내 문구
- **후보(선택지)**: option 목록 (예: 찬성 / 반대 / 기권)
- **시작일·종료일**: 투표 기간

이 단계에서 컨트랙트에 vote session이 생성되고, 아직은 **투표자 등록만 가능**한 상태입니다.

---

## 2. 관리자: 투표자 등록

참여할 사람들이 **사용자 웹**에서 Google 로그인 후 "참여하기" 등을 눌러 등록 요청을 보냅니다.

- 사용자 앱이 **commitment**(identity commitment)를 만들고, 서버·컨트랙트에 등록 요청을 보냅니다.
- **관리자**는 이 commitment들을 컨트랙트의 `appendCommitment` / `appendCommitmentsBatch`로 등록합니다. (또는 시스템이 자동으로 반영하도록 구성할 수 있습니다.)

이때 사용자 쪽에서는 **secret**이 본인 기기에만 저장되고, 서버나 블록체인에는 올라가지 않습니다.

---

## 3. 관리자: 투표 등록 마감

등록 받기를 끝낸 뒤, 관리자가 **등록 마감**을 합니다.

- **Merkle root** 설정: 현재까지 등록된 commitment들로 Merkle tree를 만들고, 그 root를 컨트랙트에 `setVoterRegistryRoot`로 설정합니다.
- **등록 마감**: `closeRegistration`을 호출해 더 이상 새 투표자를 받지 않고, 동시에 **투표 기간**이 시작됩니다.

이 시점부터 **등록된 투표자만** 투표할 수 있습니다.

---

## 4. 사용자: 증명(proof) 생성

투표 기간 안에 **사용자(투표자)**가 투표하려면:

1. 사용자 웹에 **Google 로그인** 후, 해당 투표 화면으로 이동합니다.
2. 원하는 **후보(option)**를 선택합니다.
3. **투표** 버튼을 누르면, 앱이 **브라우저에서** 다음을 수행합니다:
   - 등록 시 저장해 둔 **secret**과 현재 vote 정보로 **ZK proof**(Groth16)를 생성하고
   - public inputs(merkle root, nullifier, vote commitment, candidate count)를 준비합니다.

proof 생성은 클라이언트에서만 이루어지므로, secret이 서버로 나가지 않습니다. 첫 proof 생성 시 수 초 걸릴 수 있습니다.

---

## 5. 사용자: 투표

proof와 public inputs가 준비되면:

1. 앱이 **castVote** 트랜잭션(nullifier, optionId, proof, publicInputs 등)을 블록체인에 제출합니다.
2. 컨트랙트는 **Precompile(0x16)**으로 Groth16 proof를 검증하고, nullifier 중복 여부를 확인한 뒤 투표를 집계합니다.
3. 트랜잭션이 확정되면 **투표 완료**입니다. 한 사람당 한 번만 유효합니다.

"전송 중", "확정됨" 등은 화면 메시지로 확인할 수 있습니다.

---

## 요약 표

| 순서 | 담당   | 단계           | 설명                                                     |
| ---- | ------ | -------------- | -------------------------------------------------------- |
| 1    | 관리자 | 투표 등록      | 제목, 설명, 후보, 기간 설정으로 vote session 생성        |
| 2    | 관리자 | 투표자 등록    | 사용자 commitment를 컨트랙트에 등록                      |
| 3    | 관리자 | 투표 등록 마감 | Merkle root 설정 후 `closeRegistration` → 투표 기간 시작 |
| 4    | 사용자 | proof 생성     | 브라우저에서 secret으로 ZK proof 생성                    |
| 5    | 사용자 | 투표           | proof 포함 castVote 트랜잭션 제출                        |

다음: [기본 사용법](/docs/zk-vote/guides/basic-usage)에서 관리자·사용자별로 할 일을 더 자세히 볼 수 있습니다.
